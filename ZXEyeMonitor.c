//**********************************************************************
//**********************************************************************
//**                                                                                                              **
//**     Copyright (c) 2015 Shanghai Zhaoxin Semiconductor Co., Ltd.                     **
//**                                                                                                              **
//**     Author: Chris J.Wang  --  chrisjwang@zhaoxin.com                                  **
//**********************************************************************
//**********************************************************************


#include "ZXEyeMonitor.h"

#include "Top.h"

#define DEBUG_EYE 0

extern UINT8 CurrentLinkGenSpeed;



/*START*********************************************************************/
#define EYESCAN_DONE 0
#define RANGE_X1 1
#define RANGE_Y1 2
#define RANGE_X2 3
#define RANGE_Y2 4
#define ALL_PORT 5
#define EQ_PORT_NAME 6
#define RBER_THRESHHOLD 7
#define EYESCANTM 8
#define EYESCANEN 9
#define LANE_SEL 10  //mode 2 special




RFD Mode12Def[] = {
		{PCIEPHYCFG_EYE_MONITOR, 22, 22}, //0
		{PCIEPHYCFG_EYE_MONITOR_3,0,6},  // 1
		{PCIEPHYCFG_EYE_MONITOR_4,0,5},
		{PCIEPHYCFG_EYE_MONITOR_5,0,6},
		{PCIEPHYCFG_EYE_MONITOR_6,0,5},
		{PCIEPHYCFG_EYE_MONITOR_2,0,0},  // 5
		{PCIEPHYCFG_EYE_MONITOR,12,20},
		{PCIEPHYCFG_EYE_MONITOR_7, 0,3},   //7
		{PCIEPHYCFG_EYE_MONITOR,0,7},
		{PCIEPHYCFG_EYE_MONITOR, 21,21},
		{PCIEPHYCFG_EYE_MONITOR_2, 1,3},  //10
};
/**********************************************************************END*/


/*START*********************************************************************/

M3StFEL Mode3Def[TOTAL_LANE] = {
	{0,{
		{PCIEPHYCFG_EYE_MONITOR_LANE00, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE00, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE00_G1, 0 ,5},//EQTNVTH_G1 2
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE00_G2, 0 ,5},//EQTNVTH_G2 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE00_G3, 0 ,5},//EQTNVTH_G3 4
		{PCIEPHYCFG_EYE_MONITOR_LANE00, 7 ,7},//BERCNTEN 5
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE00, 0, 9},//BERCNT6	
		{PCIEPHYCFG_RESERVED_Z20,2,3}, //ABCSEL_CDR 7
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_00,0,4}, //DC_OUT 8
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_00,0,4}, //HF_OUT  9
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_00,0,4},  //OS_OUT   10
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_00,0,4},   //W1 OUT  11
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_00,0,4},   //W2 OUT  12
		{PCIEPHYCFG_FAREND_TX_PRESET_00,0,3},   //Farend-TxPreset 13
		{PCIEPHYCFG_FAREND_PRE_CURSOR_00,0,5},   //Farend-TxPreCursor 14
		{PCIEPHYCFG_FAREND_CURSOR_00,0,5},   //Farend-TxCursor 15
		{PCIEPHYCFG_FAREND_POST_CURSOR_00,0,5},   //Farend-TxPostCursor 16
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE00,0,5},   //Farend-FS 17
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE00,0,5},   //Farend-LF 18
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE00_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE00_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE00_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE00_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE00_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE00_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE00_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE00,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE00_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE00_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z20,4,5}, //	FHPn_CKBUFSEL_CDR		29

	}},
	{1,{
		{PCIEPHYCFG_EYE_MONITOR_LANE01, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE01, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE01_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE01_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE01_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE01, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE01, 0, 9},//BERCNT 7		
		{PCIEPHYCFG_RESERVED_Z22,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_01,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_01,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_01,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_01,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_01,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_01,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_01,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_01,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_01,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE01,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE01,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE01_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE01_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE01_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE01_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE01_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE01_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE01_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE01,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE01_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE01_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z22,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{2,{
		{PCIEPHYCFG_EYE_MONITOR_LANE02, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE02, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE02_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE02_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE02_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE02, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE02, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z24,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_02,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_02,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_02,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_02,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_02,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_02,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_02,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_02,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_02,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE02,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE02,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE02_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE02_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE02_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE02_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE02_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE02_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE02_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE02,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE02_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE02_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z24,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{3,{
		{PCIEPHYCFG_EYE_MONITOR_LANE03, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE03, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE03_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE03_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE03_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE03, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE03, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z26,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_03,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_03,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_03,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_03,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_03,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_03,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_03,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_03,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_03,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE03,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE03,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE03_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE03_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE03_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE03_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE03_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE03_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE03_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE03,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE03_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE03_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z26,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{4,{
		{PCIEPHYCFG_EYE_MONITOR_LANE04, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE04, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE04_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE04_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE04_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE04, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE04, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z28,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_04,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_04,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_04,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_04,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_04,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_04,0,3},   //Farend-TxPreset 14
		{PCIEPHYCFG_FAREND_PRE_CURSOR_04,0,5},   //Farend-TxPreCursor 15
		{PCIEPHYCFG_FAREND_CURSOR_04,0,5},   //Farend-TxCursor 16
		{PCIEPHYCFG_FAREND_POST_CURSOR_04,0,5},   //Farend-TxPostCursor 17
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE04,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE04,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE04_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE04_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE04_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE04_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE04_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE04_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE04_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE04,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE04_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE04_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z28,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{5,{
		{PCIEPHYCFG_EYE_MONITOR_LANE05, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE05, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE05_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE05_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE05_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE05, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE05, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z30,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_05,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_05,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_05,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_05,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_05,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_05,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_05,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_05,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_05,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE05,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE05,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE05_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE05_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE05_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE05_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE05_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE05_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE05_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE05,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE05_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE05_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z30,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{6,{
		{PCIEPHYCFG_EYE_MONITOR_LANE06, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE06, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE06_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE06_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE06_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE06, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE06, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z32,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_06,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_06,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_06,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_06,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_06,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_06,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_06,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_06,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_06,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE06,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE06,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE06_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE06_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE06_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE06_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE06_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE06_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE06_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE06,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE06_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE06_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z32,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{7,{
		{PCIEPHYCFG_EYE_MONITOR_LANE07, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE07, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE07_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE07_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE07_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE07, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE07, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z34,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHY_LANE_07,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHY_LANE_07,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHY_LANE_07,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHY_LANE_07,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHY_LANE_07,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_07,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_07,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_07,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_07,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE07,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE07,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE07_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE07_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE07_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE07_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE07_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE07_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE07_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE07,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE07_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE07_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z34,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{8,{
		{PCIEPHYCFG_EYE_MONITOR_LANE08, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE08, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE08_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE08_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE08_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE08, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE08, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z36,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_08,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_08,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_08,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_08,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_08,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_08,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_08,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_08,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_08,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE08,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE08,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE08_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE08_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE08_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE08_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE08_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE08_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE08_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE08,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE08_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE08_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z36,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{9,{
		{PCIEPHYCFG_EYE_MONITOR_LANE09, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE09, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE09_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE09_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE09_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE09, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE09, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z38,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_09,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_09,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_09,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_09,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_09,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_09,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_09,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_09,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_09,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE09,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE09,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE09_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE09_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE09_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE09_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE09_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE09_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE09_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE09,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE09_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE09_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z38,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{10,{
		{PCIEPHYCFG_EYE_MONITOR_LANE10, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE10, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE10_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE10_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE10_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE10, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE10, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z40,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_10,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_10,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_10,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_10,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_10,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_10,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_10,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_10,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_10,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE10,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE10,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE10_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE10_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE10_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE10_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE10_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE10_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE10_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE10,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE10_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE10_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z40,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{11,{
		{PCIEPHYCFG_EYE_MONITOR_LANE11, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE11, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE11_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE11_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE11_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE11, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE11, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z42,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_11,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_11,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_11,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_11,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_11,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_11,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_11,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_11,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_11,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE11,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE11,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE11_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE11_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE11_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE11_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE11_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE11_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE11_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE11,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE11_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE11_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z42,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{12,{
		{PCIEPHYCFG_EYE_MONITOR_LANE12, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE12, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE12_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE12_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE12_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE12, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE12, 0, 9},//BERCNT 7
		{PCIEPHYCFG_RESERVED_Z44,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_12,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_12,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_12,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_12,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_12,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_12,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_12,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_12,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_12,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE12,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE12,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE12_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE12_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE12_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE12_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE12_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE12_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE12_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE12,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE12_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE12_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z44,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{13,{
		{PCIEPHYCFG_EYE_MONITOR_LANE13, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE13, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE13_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE13_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE13_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE13, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE13, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z46,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_13,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_13,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_13,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_13,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_13,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_13,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_13,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_13,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_13,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE13,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE13,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE13_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE13_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE13_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE13_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE13_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE13_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE13_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE13,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE13_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE13_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z46,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{14,{
		{PCIEPHYCFG_EYE_MONITOR_LANE14, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE14, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE14_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE14_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE14_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE14, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE14, 0, 9},//BERCNT 7	
		{PCIEPHYCFG_RESERVED_Z111,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_14,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_14,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_14,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_14,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_14,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_14,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_14,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_14,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_14,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE14,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE14,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE14_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE14_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE14_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE14_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE14_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE14_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE14_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE14,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE14_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE14_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z111,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}},
	{15,{
		{PCIEPHYCFG_EYE_MONITOR_LANE15, 12, 12},//BERCNTRSTB 0
		{PCIEPHYCFG_EYE_MONITOR_LANE15, 0, 6},//PH_OS 1
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE15_G1, 0 ,5},//EQTNVTH_G1 3
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE15_G2, 0 ,5},//EQTNVTH_G2 4
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE15_G3, 0 ,5},//EQTNVTH_G3 5
		{PCIEPHYCFG_EYE_MONITOR_LANE15, 7 ,7},//BERCNTEN 6
		{PCIEPHYCFG_BER_CNTER_RESULT_LANE15, 0, 9},//BERCNT 7		
		{PCIEPHYCFG_RESERVED_Z113,2,3}, //ABCSEL_CDR 8
		{PCIEPHYCFG_LEQ_DC_OUTPUT_EPHYLANE_15,0,4}, //DC_OUT 9
		{PCIEPHYCFG_LEQ_HF_OUTPUT_EPHYLANE_15,0,4}, //HF_OUT  10
		{PCIEPHYCFG_LEQ_OFS_OUTPUT_EPHYLANE_15,0,4},  //OS_OUT   11
		{PCIEPHYCFG_LEQ_WEIGHT1_OUTPUT_EPHYLANE_15,0,4},   //W1 OUT  12
		{PCIEPHYCFG_LEQ_WEIGHT2_OUTPUT_EPHYLANE_15,0,4},   //W2 OUT  13
		{PCIEPHYCFG_FAREND_TX_PRESET_15,0,3},   //Farend-TxPreset
		{PCIEPHYCFG_FAREND_PRE_CURSOR_15,0,5},   //Farend-TxPreCursor
		{PCIEPHYCFG_FAREND_CURSOR_15,0,5},   //Farend-TxCursor
		{PCIEPHYCFG_FAREND_POST_CURSOR_15,0,5},   //Farend-TxPostCursor
		{PCIEPHYCFG_FAR_END_DEV_FULL_SWING_VALUE_LANE15,0,5},   //Farend-FS 18
		{PCIEPHYCFG_FAR_END_DEV_LOW_FREQ_VALUE_LANE15,0,5},   //Farend-LF 19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE15_G3,0,5},  //LPn_EQTNVTH<4:0>    19
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_2_LANE15_G3,15,15},  // LPn_DCSETEN  ----- 20
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE15_G3,7,7},  // LPn_HFSETEN   21
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_3_LANE15_G3,15,15},  // LPn_OSSETEN    22
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE15_G3,7,7},  // LPn_W1SETEN		23
		{PCIEPHYCFG_EQUALIZER_ADAPTIVE_4_LANE15_G3,15,15},  // LPn_W2SETEN	24
		{PCIEPHYCFG_RCV_LANE15_G3,2,4},	//  LPn_RCV_HBW<2:0>  -----			25
		{PCIEPHYCFG_RCV_CDR_EQ_CTL_LANE15,10,10},	//  FHPn_CDR_UGB_HBW 		26
		{PCIEPHYCFG_CDR_1_LANE15_G3,2,3},	//  LPn_KIPRSE<1:0>	27
		{PCIEPHYCFG_CDR_1_LANE15_G3,6,7}, //	LPn_KIPCSEL<1:0>		28
		{PCIEPHYCFG_RESERVED_Z113,4,5}, //	FHPn_CKBUFSEL_CDR		29
	}}
};
/**********************************************************************END*/




#if 0

/**
	@param:
		CfgFile: the configure file read in
		Hx,Vx: {Hx,Vx} to determine a point(better to be a 8bit alignment value)
		OutPutFile: file to be output to record the BER_VAL result
				EXP:name of outputfile can be a combination of Mode1_X_Y_...
**/
EFI_STATUS
OutPutBerVal(CHAR16 * CfgFile, UINT32 Hx, UINT32 Vx, CHAR16 *OutPutFile)
{
	CHAR16 * FileName = CfgFile;
	UINT32 EyeScanResultBaseAddr;
	CHAR16 strinx[128];
	UINT32 BaseAddr;
	CHAR16 Berval[2048];
	UINT64 foff = 0;
	UINT32 ix;
	UINT32 Hxf,Vxf;

	GetParamData(FileName, L"BER_VAL_BASE", strinx);
	EyeScanResultBaseAddr = Str2Num(strinx);
	Print(L"<OutPutBerVal> EyeScanResultBaseAddr = [0x%08x]\n", EyeScanResultBaseAddr);	
#if DEBUG_EYE
	Print(L"<OutPutBerVal-d> BER_VAL_BASE = %s\n", strinx);
#endif	
	
	GetParamData(FileName, L"eye_MemBase", strinx);
	BaseAddr = Str2Num(strinx);
	Print(L"<OutPutBerVal> eye_MemBase = [0x%08x]\n", BaseAddr);


	Hxf = Hx;
	Vxf = Vx;
#if 0	 //if we don't need 8 bit alignment,those code can be comment out
	// 8bit alignment
	if(Hx%8 != 0){
		Hxf = Hx + (8 - (Hx%8)); 	
	}	
	if(Vx%8 != 0){
		Vxf = Vx + (8 - (Vx%8));
	}
#if DEBUG_EYE
	Print(L"<OutPutBerVal-d> BER_VAL range = {%d[0x%x], %d[0x%x]}\n", Hxf,Hxf,Vxf,Vxf);
#endif
	Hxf--;   // we need to calculate from 0 to (Hxf-1), total Hxf points
	Vxf--; 
#endif	
	Print(L"<OutPutBerVal> BER_VAL range = {0,0} --- {%d[0x%x], %d[0x%x]}\n", Hxf,Hxf,Vxf,Vxf);


	//Read all 2048 point Berval from BER_VAL register set
	for(ix = 0; ix < 2048; ix++){
//		Berval[ix] = (MmioRead8(BaseAddr + EyeScanResultBaseAddr + ix) & (1<<ix))? 1: 0;
	}


	//
	//
	//
	//WriteII(OutPutFile, );
	foff = 0;

	for(ix = 0; ix<((Hxf+1)*(Vxf +1)); ix++){  //H
		if((ix%(Hxf+1)) == 0){
			WriteIIPos(OutPutFile, L"\n", foff);
			foff++;
		}
	
		if(Berval[ix]){
			WriteIIPos(OutPutFile, L"*", foff);
			foff++;
		}else{
			WriteIIPos(OutPutFile, L"-", foff);
			foff++;
		}
	}
		

		

	WriteIIPos(L"a.log", L"*", 0);
	
	


	return EFI_SUCCESS;
}
#endif




#if 1
/**
	This is a brand new function to implement the result output 
	@param:
		CfgFile: the configure file read in
		Hx,Vx: {Hx,Vx} to determine a point(better to be a 8bit alignment value)
		OutPutFile: file to be output to record the BER_VAL result
				EXP:name of outputfile can be a combination of Mode1_X_Y_...
**/
EFI_STATUS
OutPutBerVal_2(CHAR16 * CfgFile, UINT32 x1, UINT32 y1,UINT32 x2, UINT32 y2, CHAR16 *OutPutFile)
{
	CHAR16 * FileName = CfgFile;
	UINT8 *pBERVAL;
	UINT32 BaseAddr;
	UINT32 DataTemp32 = NOT_FOUND_STRING; 
	CHAR16 strinx[128];

	UINT64 foff = 0;
	UINT32 ix;
	UINT32 Hxf,Vxf;
	UINT32 Point= 0;



	//Str8 = (UINT8 *)AllocateZeroPool(1024);
	//FreePool(strintmp1);


	DataTemp32 = (UINT32)GetParamData(FileName, L"eye_MemBase", strinx);
	if(DataTemp32 != NOT_FOUND_STRING){
		BaseAddr = Str2Num(strinx);
		Print(L"<OutPutBerVal> eye_MemBase = [0x%08x]\n", BaseAddr);

	}else{
		BaseAddr = NOT_FOUND_STRING;
		Print(L"-------------- eye_MemBase  NULL\n");
		return EFI_UNSUPPORTED;
	}
	

	//
	// allocate 2048 bytes for BERVAL variable
	//
	pBERVAL = (UINT8 *)AllocateZeroPool(2048); 	//allocate 2048 bytes
	if(pBERVAL == NULL){
		Print(L"ERROR:OutPutBerVal_2()!!!!");
		return EFI_UNSUPPORTED;
	}

	//
	// Get BERVAL value from register
	//
	for(ix = 0; ix < 2048; ix++){
#if QEMU_SIM
		// do nothing
#else
		*(pBERVAL+ix)  = (MmioRead8(BaseAddr + BERVAL_BASE + (ix/8)) & (1<<(ix%8)))? 1: 0;
#endif
	}


	//
	// following is the relationship between BAERVAL and Start/End Point
	// 	here we consider 64 x 32 point case
	//
	if(x2>x1){ //regular case
		Hxf = (x2-x1);
		Vxf = y2-y1;
	}else{ //across 0 point case 
		Hxf =((x2+64)-x1);
		Vxf = y2-y1;
	}	

	//
	//Write log 
	//
	foff = 0;

	for(ix = 0; ix<((Hxf+1)*(Vxf +1)); ix++){  //H
		if((ix%(Hxf+1)) == 0){
			WriteIIPos(OutPutFile, L"\n", foff);
			foff++;
		}

		if(*(pBERVAL+ix)){
			WriteIIPos(OutPutFile, L"o", foff);
			foff++;
			Point++;
		}else{
			WriteIIPos(OutPutFile, L"-", foff);
			foff++;
			Point++;
		}
	}
	Print(L"Total: %d points\n",Point);

	//WriteIIPos(L"a.log", L"*", 0);
	FreePool(pBERVAL);
	return EFI_SUCCESS;
}
#endif





char CoorxArray[2][64] = {
{3,3,3,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3},
{2,1,0,9,8,7,6,5,4,3,2,1,0,9,8,7,6,5,4,3,2,1,0,9,8,7,6,5,4,3,2,1,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1}
};

//
//Note: before calling this function, you must GET CurrentLinkGenSpeed if you want a real Current link speed shown.
//
EFI_STATUS
OutPutBerVal_3(const UINT32 x1, const UINT32 y1,const UINT32 x2, const UINT32 y2,UINT32 EphyBase)
{
	UINT16 ix,iy;
	UINT8 PointResult = 0;
	UINT32 Hxf,Vxf,Startx;

	UINT8 Value_VRmax = 0;
	INT32 Value_PH0_neg = 0, Value_PH1_neg = 0, Value_PH0_pos = 0, Value_PH1_pos = 0;
	UINT8 passx = 0;
	
	Print(L"[%d  %d][%d  %d] \n",x1,y1,x2,y2);


	if(x2>x1){ //regular case
		Hxf = (x2-x1);
		Vxf = y2-y1;
	}else{ //across 0 point case 
		Hxf =((x2+128)-x1);
		Vxf = y2-y1;
	}
	Hxf++;
	Vxf++;
	Print(L"Hxf*Vxf = %d\n",Hxf*Vxf);
	Print(L"Hxf = %d\n",Hxf);
	Print(L"Vxf = %d\n",Vxf);




	//
	//
	//
	if((x1>=96)&&(x1<=127)){ //regular case
		Startx = x1-96;
	}else{					 //across 0 point case 
		Startx = x1+32;
	}	
	for(ix = 0; ix <2; ix++){
		Print(L"   ");	
		for(iy=(UINT16)Startx; iy<(UINT16)(Startx + Hxf);iy++){
			Print(L"%d",CoorxArray[ix][iy]);
		}
		Print(L"\n");
	}

	//
	//
	//
	Print(L"%02d|",y1);

	for(ix = 0; ix < (Hxf*Vxf); ix++){

		PointResult  = (MmioRead8(EphyBase + BERVAL_BASE + (ix/8)) & (1<<(ix%8)))? 1: 0;
		
		if(PointResult == 1){
			Print(L"o");

			passx++;
			if((ix<Hxf)&&(passx == 1)){  //first line, and the first pass point
				Value_PH0_neg = ix+(x1-128);
			}
			if(ix<Hxf){
				Value_PH0_pos = (ix%Hxf)-(128-x1);
				//Value_PH0_pos += Value_PH0_neg;
			}


			if(((ix>=Hxf)&&(ix<(2*Hxf)))&&(passx == 1)){  //second line, and the first pass point
				Value_PH1_neg = ((ix-Hxf)+(x1-128));
			}	
			if((ix>=Hxf)&&(ix<(2*Hxf))){
				Value_PH1_pos = (ix%Hxf)-(128-x1); 
				//Value_PH1_pos += Value_PH1_neg;
			}

			
			
		}else{
			Print(L"-");
		}





		if(((ix+1)%Hxf)==0){
			Print(L"\n");

			if(passx!=0){
				Value_VRmax++;
			}
#if 0
			if(ix<Hxf){  //first line
				Value_PH0_pos = passx + Value_PH0_neg+1;	
			}
			if((ix>=Hxf)&&(ix<(2*Hxf))){  //second line
				Value_PH1_pos = passx + Value_PH1_neg+1;
			}
#endif			
			passx = 0;


			
			if(ix==(Hxf*Vxf-1)){
				Print(L"  |");
			}else{
				Print(L"%02d|",(y1+(ix/Hxf)+1));
			}
		}

	}	









	Print(L"\n");




	Print(L"Mode1/2:\n");
	Value_VRmax--;
	Print(L"                PH0_neg, PH0_pos, PH1_neg, PH1_pos, VRmax,,\n");
	Print(L"Summary-%d:%c            %d%c      %d%c     %d%c      %d%c    %d\n",CurrentLinkGenSpeed,9,Value_PH0_neg,9,  Value_PH0_pos,9,Value_PH1_neg,9, Value_PH1_pos,9,Value_VRmax);
	
	Print(L"EyeWidthFlag:%c  0x%02x%c -%c %d%c \n" , 
		9,
		Value_PH0_pos-Value_PH0_neg+1,9,9,
		Value_PH0_pos-Value_PH0_neg+1,9);



	
	return EFI_SUCCESS;
}



STATIC 
VOID
Set_R_EYE_MANU_MUX(
	UINT32 BaseAddr, 
	UINT8 value)
{
	if(value){
		AsiaMemoryModify8(BaseAddr+PCIEPHYCFG_EYE_MONITOR_7,PCIEPHYCFG_R_EYE_MANU_MUX,PCIEPHYCFG_R_EYE_MANU_MUX);
	}else{
		AsiaMemoryModify8(BaseAddr+PCIEPHYCFG_EYE_MONITOR_7,PCIEPHYCFG_R_EYE_MANU_MUX,0);
	}

}


/**
	EyeMode3Scan

	@param:pMode3Reg: the pointer to register defination for EyeMonitor Mode3 for each lane 
		
	(32,31) (33,31) (34,31) (35,31) (36,31) (37,31) (38,31) (39,31) (40,31) (41,31) (42,31) (43,31) (44,31) (45,31) (46,31) (47,31) (48,31) (49,31) (50,31) (51,31) (52,31) (53,31) (54,31) (55,31) (56,31) (57,31) (58,31) (59,31) (60,31) (61,31) (62,31) (63,31) (00,31) (01,31) (02,31) (03,31) (04,31) (05,31) (06,31) (07,31) (08,31) (09,31) (10,31) (11,31) (12,31) (13,31) (14,31) (15,31) (16,31) (17,31) (18,31) (19,31) (20,31) (21,31) (22,31) (23,31) (24,31) (25,31) (26,31) (27,31) (28,31) (29,31) (30,31) (31,31) 
	(32,30) (33,30) (34,30) (35,30) (36,30) (37,30) (38,30) (39,30) (40,30) (41,30) (42,30) (43,30) (44,30) (45,30) (46,30) (47,30) (48,30) (49,30) (50,30) (51,30) (52,30) (53,30) (54,30) (55,30) (56,30) (57,30) (58,30) (59,30) (60,30) (61,30) (62,30) (63,30) (00,30) (01,30) (02,30) (03,30) (04,30) (05,30) (06,30) (07,30) (08,30) (09,30) (10,30) (11,30) (12,30) (13,30) (14,30) (15,30) (16,30) (17,30) (18,30) (19,30) (20,30) (21,30) (22,30) (23,30) (24,30) (25,30) (26,30) (27,30) (28,30) (29,30) (30,30) (31,30) 
	(32,29) (33,29) (34,29) (35,29) (36,29) (37,29) (38,29) (39,29) (40,29) (41,29) (42,29) (43,29) (44,29) (45,29) (46,29) (47,29) (48,29) (49,29) (50,29) (51,29) (52,29) (53,29) (54,29) (55,29) (56,29) (57,29) (58,29) (59,29) (60,29) (61,29) (62,29) (63,29) (00,29) (01,29) (02,29) (03,29) (04,29) (05,29) (06,29) (07,29) (08,29) (09,29) (10,29) (11,29) (12,29) (13,29) (14,29) (15,29) (16,29) (17,29) (18,29) (19,29) (20,29) (21,29) (22,29) (23,29) (24,29) (25,29) (26,29) (27,29) (28,29) (29,29) (30,29) (31,29) 
	(32,28) (33,28) (34,28) (35,28) (36,28) (37,28) (38,28) (39,28) (40,28) (41,28) (42,28) (43,28) (44,28) (45,28) (46,28) (47,28) (48,28) (49,28) (50,28) (51,28) (52,28) (53,28) (54,28) (55,28) (56,28) (57,28) (58,28) (59,28) (60,28) (61,28) (62,28) (63,28) (00,28) (01,28) (02,28) (03,28) (04,28) (05,28) (06,28) (07,28) (08,28) (09,28) (10,28) (11,28) (12,28) (13,28) (14,28) (15,28) (16,28) (17,28) (18,28) (19,28) (20,28) (21,28) (22,28) (23,28) (24,28) (25,28) (26,28) (27,28) (28,28) (29,28) (30,28) (31,28) 
	(32,27) (33,27) (34,27) (35,27) (36,27) (37,27) (38,27) (39,27) (40,27) (41,27) (42,27) (43,27) (44,27) (45,27) (46,27) (47,27) (48,27) (49,27) (50,27) (51,27) (52,27) (53,27) (54,27) (55,27) (56,27) (57,27) (58,27) (59,27) (60,27) (61,27) (62,27) (63,27) (00,27) (01,27) (02,27) (03,27) (04,27) (05,27) (06,27) (07,27) (08,27) (09,27) (10,27) (11,27) (12,27) (13,27) (14,27) (15,27) (16,27) (17,27) (18,27) (19,27) (20,27) (21,27) (22,27) (23,27) (24,27) (25,27) (26,27) (27,27) (28,27) (29,27) (30,27) (31,27) 
	(32,26) (33,26) (34,26) (35,26) (36,26) (37,26) (38,26) (39,26) (40,26) (41,26) (42,26) (43,26) (44,26) (45,26) (46,26) (47,26) (48,26) (49,26) (50,26) (51,26) (52,26) (53,26) (54,26) (55,26) (56,26) (57,26) (58,26) (59,26) (60,26) (61,26) (62,26) (63,26) (00,26) (01,26) (02,26) (03,26) (04,26) (05,26) (06,26) (07,26) (08,26) (09,26) (10,26) (11,26) (12,26) (13,26) (14,26) (15,26) (16,26) (17,26) (18,26) (19,26) (20,26) (21,26) (22,26) (23,26) (24,26) (25,26) (26,26) (27,26) (28,26) (29,26) (30,26) (31,26) 
	(32,25) (33,25) (34,25) (35,25) (36,25) (37,25) (38,25) (39,25) (40,25) (41,25) (42,25) (43,25) (44,25) (45,25) (46,25) (47,25) (48,25) (49,25) (50,25) (51,25) (52,25) (53,25) (54,25) (55,25) (56,25) (57,25) (58,25) (59,25) (60,25) (61,25) (62,25) (63,25) (00,25) (01,25) (02,25) (03,25) (04,25) (05,25) (06,25) (07,25) (08,25) (09,25) (10,25) (11,25) (12,25) (13,25) (14,25) (15,25) (16,25) (17,25) (18,25) (19,25) (20,25) (21,25) (22,25) (23,25) (24,25) (25,25) (26,25) (27,25) (28,25) (29,25) (30,25) (31,25) 
	(32,24) (33,24) (34,24) (35,24) (36,24) (37,24) (38,24) (39,24) (40,24) (41,24) (42,24) (43,24) (44,24) (45,24) (46,24) (47,24) (48,24) (49,24) (50,24) (51,24) (52,24) (53,24) (54,24) (55,24) (56,24) (57,24) (58,24) (59,24) (60,24) (61,24) (62,24) (63,24) (00,24) (01,24) (02,24) (03,24) (04,24) (05,24) (06,24) (07,24) (08,24) (09,24) (10,24) (11,24) (12,24) (13,24) (14,24) (15,24) (16,24) (17,24) (18,24) (19,24) (20,24) (21,24) (22,24) (23,24) (24,24) (25,24) (26,24) (27,24) (28,24) (29,24) (30,24) (31,24) 
	(32,23) (33,23) (34,23) (35,23) (36,23) (37,23) (38,23) (39,23) (40,23) (41,23) (42,23) (43,23) (44,23) (45,23) (46,23) (47,23) (48,23) (49,23) (50,23) (51,23) (52,23) (53,23) (54,23) (55,23) (56,23) (57,23) (58,23) (59,23) (60,23) (61,23) (62,23) (63,23) (00,23) (01,23) (02,23) (03,23) (04,23) (05,23) (06,23) (07,23) (08,23) (09,23) (10,23) (11,23) (12,23) (13,23) (14,23) (15,23) (16,23) (17,23) (18,23) (19,23) (20,23) (21,23) (22,23) (23,23) (24,23) (25,23) (26,23) (27,23) (28,23) (29,23) (30,23) (31,23) 
	(32,22) (33,22) (34,22) (35,22) (36,22) (37,22) (38,22) (39,22) (40,22) (41,22) (42,22) (43,22) (44,22) (45,22) (46,22) (47,22) (48,22) (49,22) (50,22) (51,22) (52,22) (53,22) (54,22) (55,22) (56,22) (57,22) (58,22) (59,22) (60,22) (61,22) (62,22) (63,22) (00,22) (01,22) (02,22) (03,22) (04,22) (05,22) (06,22) (07,22) (08,22) (09,22) (10,22) (11,22) (12,22) (13,22) (14,22) (15,22) (16,22) (17,22) (18,22) (19,22) (20,22) (21,22) (22,22) (23,22) (24,22) (25,22) (26,22) (27,22) (28,22) (29,22) (30,22) (31,22) 
	(32,21) (33,21) (34,21) (35,21) (36,21) (37,21) (38,21) (39,21) (40,21) (41,21) (42,21) (43,21) (44,21) (45,21) (46,21) (47,21) (48,21) (49,21) (50,21) (51,21) (52,21) (53,21) (54,21) (55,21) (56,21) (57,21) (58,21) (59,21) (60,21) (61,21) (62,21) (63,21) (00,21) (01,21) (02,21) (03,21) (04,21) (05,21) (06,21) (07,21) (08,21) (09,21) (10,21) (11,21) (12,21) (13,21) (14,21) (15,21) (16,21) (17,21) (18,21) (19,21) (20,21) (21,21) (22,21) (23,21) (24,21) (25,21) (26,21) (27,21) (28,21) (29,21) (30,21) (31,21) 
	(32,20) (33,20) (34,20) (35,20) (36,20) (37,20) (38,20) (39,20) (40,20) (41,20) (42,20) (43,20) (44,20) (45,20) (46,20) (47,20) (48,20) (49,20) (50,20) (51,20) (52,20) (53,20) (54,20) (55,20) (56,20) (57,20) (58,20) (59,20) (60,20) (61,20) (62,20) (63,20) (00,20) (01,20) (02,20) (03,20) (04,20) (05,20) (06,20) (07,20) (08,20) (09,20) (10,20) (11,20) (12,20) (13,20) (14,20) (15,20) (16,20) (17,20) (18,20) (19,20) (20,20) (21,20) (22,20) (23,20) (24,20) (25,20) (26,20) (27,20) (28,20) (29,20) (30,20) (31,20) 
	(32,19) (33,19) (34,19) (35,19) (36,19) (37,19) (38,19) (39,19) (40,19) (41,19) (42,19) (43,19) (44,19) (45,19) (46,19) (47,19) (48,19) (49,19) (50,19) (51,19) (52,19) (53,19) (54,19) (55,19) (56,19) (57,19) (58,19) (59,19) (60,19) (61,19) (62,19) (63,19) (00,19) (01,19) (02,19) (03,19) (04,19) (05,19) (06,19) (07,19) (08,19) (09,19) (10,19) (11,19) (12,19) (13,19) (14,19) (15,19) (16,19) (17,19) (18,19) (19,19) (20,19) (21,19) (22,19) (23,19) (24,19) (25,19) (26,19) (27,19) (28,19) (29,19) (30,19) (31,19) 
	(32,18) (33,18) (34,18) (35,18) (36,18) (37,18) (38,18) (39,18) (40,18) (41,18) (42,18) (43,18) (44,18) (45,18) (46,18) (47,18) (48,18) (49,18) (50,18) (51,18) (52,18) (53,18) (54,18) (55,18) (56,18) (57,18) (58,18) (59,18) (60,18) (61,18) (62,18) (63,18) (00,18) (01,18) (02,18) (03,18) (04,18) (05,18) (06,18) (07,18) (08,18) (09,18) (10,18) (11,18) (12,18) (13,18) (14,18) (15,18) (16,18) (17,18) (18,18) (19,18) (20,18) (21,18) (22,18) (23,18) (24,18) (25,18) (26,18) (27,18) (28,18) (29,18) (30,18) (31,18) 
	(32,17) (33,17) (34,17) (35,17) (36,17) (37,17) (38,17) (39,17) (40,17) (41,17) (42,17) (43,17) (44,17) (45,17) (46,17) (47,17) (48,17) (49,17) (50,17) (51,17) (52,17) (53,17) (54,17) (55,17) (56,17) (57,17) (58,17) (59,17) (60,17) (61,17) (62,17) (63,17) (00,17) (01,17) (02,17) (03,17) (04,17) (05,17) (06,17) (07,17) (08,17) (09,17) (10,17) (11,17) (12,17) (13,17) (14,17) (15,17) (16,17) (17,17) (18,17) (19,17) (20,17) (21,17) (22,17) (23,17) (24,17) (25,17) (26,17) (27,17) (28,17) (29,17) (30,17) (31,17) 
	(32,16) (33,16) (34,16) (35,16) (36,16) (37,16) (38,16) (39,16) (40,16) (41,16) (42,16) (43,16) (44,16) (45,16) (46,16) (47,16) (48,16) (49,16) (50,16) (51,16) (52,16) (53,16) (54,16) (55,16) (56,16) (57,16) (58,16) (59,16) (60,16) (61,16) (62,16) (63,16) (00,16) (01,16) (02,16) (03,16) (04,16) (05,16) (06,16) (07,16) (08,16) (09,16) (10,16) (11,16) (12,16) (13,16) (14,16) (15,16) (16,16) (17,16) (18,16) (19,16) (20,16) (21,16) (22,16) (23,16) (24,16) (25,16) (26,16) (27,16) (28,16) (29,16) (30,16) (31,16) 
	(32,15) (33,15) (34,15) (35,15) (36,15) (37,15) (38,15) (39,15) (40,15) (41,15) (42,15) (43,15) (44,15) (45,15) (46,15) (47,15) (48,15) (49,15) (50,15) (51,15) (52,15) (53,15) (54,15) (55,15) (56,15) (57,15) (58,15) (59,15) (60,15) (61,15) (62,15) (63,15) (00,15) (01,15) (02,15) (03,15) (04,15) (05,15) (06,15) (07,15) (08,15) (09,15) (10,15) (11,15) (12,15) (13,15) (14,15) (15,15) (16,15) (17,15) (18,15) (19,15) (20,15) (21,15) (22,15) (23,15) (24,15) (25,15) (26,15) (27,15) (28,15) (29,15) (30,15) (31,15) 
	(32,14) (33,14) (34,14) (35,14) (36,14) (37,14) (38,14) (39,14) (40,14) (41,14) (42,14) (43,14) (44,14) (45,14) (46,14) (47,14) (48,14) (49,14) (50,14) (51,14) (52,14) (53,14) (54,14) (55,14) (56,14) (57,14) (58,14) (59,14) (60,14) (61,14) (62,14) (63,14) (00,14) (01,14) (02,14) (03,14) (04,14) (05,14) (06,14) (07,14) (08,14) (09,14) (10,14) (11,14) (12,14) (13,14) (14,14) (15,14) (16,14) (17,14) (18,14) (19,14) (20,14) (21,14) (22,14) (23,14) (24,14) (25,14) (26,14) (27,14) (28,14) (29,14) (30,14) (31,14) 
	(32,13) (33,13) (34,13) (35,13) (36,13) (37,13) (38,13) (39,13) (40,13) (41,13) (42,13) (43,13) (44,13) (45,13) (46,13) (47,13) (48,13) (49,13) (50,13) (51,13) (52,13) (53,13) (54,13) (55,13) (56,13) (57,13) (58,13) (59,13) (60,13) (61,13) (62,13) (63,13) (00,13) (01,13) (02,13) (03,13) (04,13) (05,13) (06,13) (07,13) (08,13) (09,13) (10,13) (11,13) (12,13) (13,13) (14,13) (15,13) (16,13) (17,13) (18,13) (19,13) (20,13) (21,13) (22,13) (23,13) (24,13) (25,13) (26,13) (27,13) (28,13) (29,13) (30,13) (31,13) 
	(32,12) (33,12) (34,12) (35,12) (36,12) (37,12) (38,12) (39,12) (40,12) (41,12) (42,12) (43,12) (44,12) (45,12) (46,12) (47,12) (48,12) (49,12) (50,12) (51,12) (52,12) (53,12) (54,12) (55,12) (56,12) (57,12) (58,12) (59,12) (60,12) (61,12) (62,12) (63,12) (00,12) (01,12) (02,12) (03,12) (04,12) (05,12) (06,12) (07,12) (08,12) (09,12) (10,12) (11,12) (12,12) (13,12) (14,12) (15,12) (16,12) (17,12) (18,12) (19,12) (20,12) (21,12) (22,12) (23,12) (24,12) (25,12) (26,12) (27,12) (28,12) (29,12) (30,12) (31,12) 
	(32,11) (33,11) (34,11) (35,11) (36,11) (37,11) (38,11) (39,11) (40,11) (41,11) (42,11) (43,11) (44,11) (45,11) (46,11) (47,11) (48,11) (49,11) (50,11) (51,11) (52,11) (53,11) (54,11) (55,11) (56,11) (57,11) (58,11) (59,11) (60,11) (61,11) (62,11) (63,11) (00,11) (01,11) (02,11) (03,11) (04,11) (05,11) (06,11) (07,11) (08,11) (09,11) (10,11) (11,11) (12,11) (13,11) (14,11) (15,11) (16,11) (17,11) (18,11) (19,11) (20,11) (21,11) (22,11) (23,11) (24,11) (25,11) (26,11) (27,11) (28,11) (29,11) (30,11) (31,11) 
	(32,10) (33,10) (34,10) (35,10) (36,10) (37,10) (38,10) (39,10) (40,10) (41,10) (42,10) (43,10) (44,10) (45,10) (46,10) (47,10) (48,10) (49,10) (50,10) (51,10) (52,10) (53,10) (54,10) (55,10) (56,10) (57,10) (58,10) (59,10) (60,10) (61,10) (62,10) (63,10) (00,10) (01,10) (02,10) (03,10) (04,10) (05,10) (06,10) (07,10) (08,10) (09,10) (10,10) (11,10) (12,10) (13,10) (14,10) (15,10) (16,10) (17,10) (18,10) (19,10) (20,10) (21,10) (22,10) (23,10) (24,10) (25,10) (26,10) (27,10) (28,10) (29,10) (30,10) (31,10) 
	(32,09) (33,09) (34,09) (35,09) (36,09) (37,09) (38,09) (39,09) (40,09) (41,09) (42,09) (43,09) (44,09) (45,09) (46,09) (47,09) (48,09) (49,09) (50,09) (51,09) (52,09) (53,09) (54,09) (55,09) (56,09) (57,09) (58,09) (59,09) (60,09) (61,09) (62,09) (63,09) (00,09) (01,09) (02,09) (03,09) (04,09) (05,09) (06,09) (07,09) (08,09) (09,09) (10,09) (11,09) (12,09) (13,09) (14,09) (15,09) (16,09) (17,09) (18,09) (19,09) (20,09) (21,09) (22,09) (23,09) (24,09) (25,09) (26,09) (27,09) (28,09) (29,09) (30,09) (31,09) 
	(32,08) (33,08) (34,08) (35,08) (36,08) (37,08) (38,08) (39,08) (40,08) (41,08) (42,08) (43,08) (44,08) (45,08) (46,08) (47,08) (48,08) (49,08) (50,08) (51,08) (52,08) (53,08) (54,08) (55,08) (56,08) (57,08) (58,08) (59,08) (60,08) (61,08) (62,08) (63,08) (00,08) (01,08) (02,08) (03,08) (04,08) (05,08) (06,08) (07,08) (08,08) (09,08) (10,08) (11,08) (12,08) (13,08) (14,08) (15,08) (16,08) (17,08) (18,08) (19,08) (20,08) (21,08) (22,08) (23,08) (24,08) (25,08) (26,08) (27,08) (28,08) (29,08) (30,08) (31,08) 
	(32,07) (33,07) (34,07) (35,07) (36,07) (37,07) (38,07) (39,07) (40,07) (41,07) (42,07) (43,07) (44,07) (45,07) (46,07) (47,07) (48,07) (49,07) (50,07) (51,07) (52,07) (53,07) (54,07) (55,07) (56,07) (57,07) (58,07) (59,07) (60,07) (61,07) (62,07) (63,07) (00,07) (01,07) (02,07) (03,07) (04,07) (05,07) (06,07) (07,07) (08,07) (09,07) (10,07) (11,07) (12,07) (13,07) (14,07) (15,07) (16,07) (17,07) (18,07) (19,07) (20,07) (21,07) (22,07) (23,07) (24,07) (25,07) (26,07) (27,07) (28,07) (29,07) (30,07) (31,07) 
	(32,06) (33,06) (34,06) (35,06) (36,06) (37,06) (38,06) (39,06) (40,06) (41,06) (42,06) (43,06) (44,06) (45,06) (46,06) (47,06) (48,06) (49,06) (50,06) (51,06) (52,06) (53,06) (54,06) (55,06) (56,06) (57,06) (58,06) (59,06) (60,06) (61,06) (62,06) (63,06) (00,06) (01,06) (02,06) (03,06) (04,06) (05,06) (06,06) (07,06) (08,06) (09,06) (10,06) (11,06) (12,06) (13,06) (14,06) (15,06) (16,06) (17,06) (18,06) (19,06) (20,06) (21,06) (22,06) (23,06) (24,06) (25,06) (26,06) (27,06) (28,06) (29,06) (30,06) (31,06) 
	(32,05) (33,05) (34,05) (35,05) (36,05) (37,05) (38,05) (39,05) (40,05) (41,05) (42,05) (43,05) (44,05) (45,05) (46,05) (47,05) (48,05) (49,05) (50,05) (51,05) (52,05) (53,05) (54,05) (55,05) (56,05) (57,05) (58,05) (59,05) (60,05) (61,05) (62,05) (63,05) (00,05) (01,05) (02,05) (03,05) (04,05) (05,05) (06,05) (07,05) (08,05) (09,05) (10,05) (11,05) (12,05) (13,05) (14,05) (15,05) (16,05) (17,05) (18,05) (19,05) (20,05) (21,05) (22,05) (23,05) (24,05) (25,05) (26,05) (27,05) (28,05) (29,05) (30,05) (31,05) 
	(32,04) (33,04) (34,04) (35,04) (36,04) (37,04) (38,04) (39,04) (40,04) (41,04) (42,04) (43,04) (44,04) (45,04) (46,04) (47,04) (48,04) (49,04) (50,04) (51,04) (52,04) (53,04) (54,04) (55,04) (56,04) (57,04) (58,04) (59,04) (60,04) (61,04) (62,04) (63,04) (00,04) (01,04) (02,04) (03,04) (04,04) (05,04) (06,04) (07,04) (08,04) (09,04) (10,04) (11,04) (12,04) (13,04) (14,04) (15,04) (16,04) (17,04) (18,04) (19,04) (20,04) (21,04) (22,04) (23,04) (24,04) (25,04) (26,04) (27,04) (28,04) (29,04) (30,04) (31,04) 
	(32,03) (33,03) (34,03) (35,03) (36,03) (37,03) (38,03) (39,03) (40,03) (41,03) (42,03) (43,03) (44,03) (45,03) (46,03) (47,03) (48,03) (49,03) (50,03) (51,03) (52,03) (53,03) (54,03) (55,03) (56,03) (57,03) (58,03) (59,03) (60,03) (61,03) (62,03) (63,03) (00,03) (01,03) (02,03) (03,03) (04,03) (05,03) (06,03) (07,03) (08,03) (09,03) (10,03) (11,03) (12,03) (13,03) (14,03) (15,03) (16,03) (17,03) (18,03) (19,03) (20,03) (21,03) (22,03) (23,03) (24,03) (25,03) (26,03) (27,03) (28,03) (29,03) (30,03) (31,03) 
	(32,02) (33,02) (34,02) (35,02) (36,02) (37,02) (38,02) (39,02) (40,02) (41,02) (42,02) (43,02) (44,02) (45,02) (46,02) (47,02) (48,02) (49,02) (50,02) (51,02) (52,02) (53,02) (54,02) (55,02) (56,02) (57,02) (58,02) (59,02) (60,02) (61,02) (62,02) (63,02) (00,02) (01,02) (02,02) (03,02) (04,02) (05,02) (06,02) (07,02) (08,02) (09,02) (10,02) (11,02) (12,02) (13,02) (14,02) (15,02) (16,02) (17,02) (18,02) (19,02) (20,02) (21,02) (22,02) (23,02) (24,02) (25,02) (26,02) (27,02) (28,02) (29,02) (30,02) (31,02) 
	(32,01) (33,01) (34,01) (35,01) (36,01) (37,01) (38,01) (39,01) (40,01) (41,01) (42,01) (43,01) (44,01) (45,01) (46,01) (47,01) (48,01) (49,01) (50,01) (51,01) (52,01) (53,01) (54,01) (55,01) (56,01) (57,01) (58,01) (59,01) (60,01) (61,01) (62,01) (63,01) (00,01) (01,01) (02,01) (03,01) (04,01) (05,01) (06,01) (07,01) (08,01) (09,01) (10,01) (11,01) (12,01) (13,01) (14,01) (15,01) (16,01) (17,01) (18,01) (19,01) (20,01) (21,01) (22,01) (23,01) (24,01) (25,01) (26,01) (27,01) (28,01) (29,01) (30,01) (31,01) 
	(32,00) (33,00) (34,00) (35,00) (36,00) (37,00) (38,00) (39,00) (40,00) (41,00) (42,00) (43,00) (44,00) (45,00) (46,00) (47,00) (48,00) (49,00) (50,00) (51,00) (52,00) (53,00) (54,00) (55,00) (56,00) (57,00) (58,00) (59,00) (60,00) (61,00) (62,00) (63,00) (00,00) (01,00) (02,00) (03,00) (04,00) (05,00) (06,00) (07,00) (08,00) (09,00) (10,00) (11,00) (12,00) (13,00) (14,00) (15,00) (16,00) (17,00) (18,00) (19,00) (20,00) (21,00) (22,00) (23,00) (24,00) (25,00) (26,00) (27,00) (28,00) (29,00) (30,00) (31,00) 



**/
CHAR16 LogFileName[] = L"EyeMode3Scan-Lanexx_A.log";
CHAR16 CoorX[] = L"00";
CHAR16 DataTemp[64][32];

UINT8 Point_PH0_neg;
UINT8 Point_PH1_neg;
UINT8 Point_PH0_pos;
UINT8 Point_PH1_pos;
UINT8 Point_VRmax;


//
//EyeMode: 2:half-rate   3:full-rate
//
EFI_STATUS
EyeMode3Scan(
	UINT8 EyeMode,
	UINT32 BaseAddr,
	UINT32 eye_mode3_GenSpeed,
	UINT32 eye_LaneSel,
	UINT64 mode3_scantime,
	UINT32 pass_threshold,
	UINT8 fast)
{
	M3StFEL *pMode3Reg = Mode3Def;
	UINT16 xx,yy,ix,iy;
	UINT16 Result;
	UINT64 pos = 0;
	UINT64 posB = 0;

	
	CHAR16* pLogFileName = &LogFileName[0];
	CHAR16* pCoorX = &CoorX[0];


	UINT16 SpecialPointFlag = 0;
	UINT16 PH1_neg_Flag = 0;
	UINT16 PH0_neg_Flag = 0;


	UINT8 DCout,HFout,OSout,W1out,W2out;

	//CHAR16* pData = &DataTemp[0][0];

#if DEBUG_EYE
	Print(L"BaseAddr: %08x\n",BaseAddr);
	Print(L"eye_mode3_GenSpeed: %08x\n",eye_mode3_GenSpeed);
	Print(L"eye_LaneSel: %08x\n",eye_LaneSel);
	Print(L"mode3_scantime: %08x\n",mode3_scantime);
	Print(L"pass_threshold: %08x\n",pass_threshold);
#endif

	if((EyeMode !=2) &&(EyeMode!=3)){
		Print(L"ERROR!: EyeMode only can be 2(half-rate) or 3(full-rate)! \n");
		return EFI_UNSUPPORTED;
	}


       //
       //Read some parameters on Link
	//
	DCout = MmioBitFieldRead8(BaseAddr+((pMode3Reg+eye_LaneSel)->Reg[DC_OUT].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[DC_OUT].start), 
								((pMode3Reg+eye_LaneSel)->Reg[DC_OUT].end));
	HFout = MmioBitFieldRead8(BaseAddr+((pMode3Reg+eye_LaneSel)->Reg[HF_OUT].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[HF_OUT].start), 
								((pMode3Reg+eye_LaneSel)->Reg[HF_OUT].end));
	OSout = MmioBitFieldRead8(BaseAddr+((pMode3Reg+eye_LaneSel)->Reg[OS_OUT].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[OS_OUT].start), 
								((pMode3Reg+eye_LaneSel)->Reg[OS_OUT].end));
	W1out = MmioBitFieldRead8(BaseAddr+((pMode3Reg+eye_LaneSel)->Reg[W1_OUT].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[W1_OUT].start), 
								((pMode3Reg+eye_LaneSel)->Reg[W1_OUT].end));
	W2out = MmioBitFieldRead8(BaseAddr+((pMode3Reg+eye_LaneSel)->Reg[W2_OUT].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[W2_OUT].start), 
								((pMode3Reg+eye_LaneSel)->Reg[W2_OUT].end));

	//
	//Read Far-end Tx Preset/Cursor 
	//
	






	//Step 0-1 Enable EPHY RxE0[6] (CPU RW for some PEMCU EYE MONITOR related registers)
	AsiaMemoryModify8(BaseAddr+0xE0,BIT6,BIT6);

	//Step 0-2 ABCSEL_CDR  half-rate EM - Enable EyeMonitor
	MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[ABCSEL_CDR].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[ABCSEL_CDR].start),
							((pMode3Reg+eye_LaneSel)->Reg[ABCSEL_CDR].end), 
							EyeMode);  
	//Step 0-3 SET PCIEPHYCFG_R_EYE_MANU_MUX
	Set_R_EYE_MANU_MUX(BaseAddr,1); //mode 3 need SW control



	for(yy = 0 ; yy<32; yy++){   
		iy = 31-yy;	 //  31-30-29....0

		for(xx = 0; xx<64;xx++){
			if(xx < 32){    //32-33-34-35-...63-0-1-2-3....31
				ix = 96+xx;
			}else{
				ix = xx-32;
			}
#if DEBUG_EYE			
			Print(L"\n===========================\n");
			Print(L"===Point:(%d,%d)===\n",ix,iy);


			Print(L"1) %x\n",(pMode3Reg+eye_LaneSel)->Reg[PH_OS].Offset);
			Print(L"2) %x\n",(pMode3Reg+eye_LaneSel)->Reg[PH_OS].start);
			Print(L"3) %x\n",(pMode3Reg+eye_LaneSel)->Reg[PH_OS].end);


			Print(L"1) %x\n",(pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].Offset);
			Print(L"2) %x\n",(pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].start);
			Print(L"3) %x\n",(pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].end);			
#endif
			
#if 1			
			// Step 1-1:
			// SW set register MCU_EYESCANEN_PEnn to 0 
			//MmioBitFieldWrite8(BaseAddr + PCIEPHYCFG_EYE_MONITOR_2 + 1, 5,5, 1);	//write 1 to clear	
			
			// Step 1-2:
			// X, Y
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[PH_OS].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[PH_OS].start),
								((pMode3Reg+eye_LaneSel)->Reg[PH_OS].end), 
								(UINT16)ix); 
			
			switch(eye_mode3_GenSpeed){
				case 1:
					MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].start),
								((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].end), 
								(UINT16)iy); 			
					break;
				case 2: 
					MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].start),
								((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].end), 
								(UINT16)iy); 				
					break;
				case 3:
					MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].start),
								((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].end), 
								(UINT16)iy); 				
					break;
				default:
					Print(L"ERROR! eye_mode3_GenSpeed\n");
			}
			
			
			
			
			// FRP**_BERCNTRSTB
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].start),
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].end), 
								0); 
			
			// Step 1-3:
			// Wait greater than 16ns and set FRP*_BERCNTRSTB to 1.
			gBS->Stall(1);														//delay 1us  --should wait at least 16ns
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].start),
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].end), 
								1); 
			
			
			// Step 1-4:
			// then wait greater than 16ns and set FRP*_BERCNTEN(FRP00_BERCNTEN at Rx222h)	to 1
			gBS->Stall(1);	
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].start),
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].end), 
								1); 
			
			// Step 1-5:
			// Wait some moment set FRP*_BERCNTEN and FRP*_BERCNTRSTB to 0, read the register EP*_BERCNT(ex: EP00_BERCNT_ at RX266[9:0])
			gBS->Stall((UINTN)mode3_scantime);
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].Offset), 
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].start),
								((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].end), 
								0); 
			
			gBS->Stall(100);
#endif				




			//
			// Get BERCNT and output to  text file
			// 	text 1: BERCNT
			//	text 2: pass or not
			//
			//Step 2-1 
			//Read the BERCNT from register
			Result = 0x3FF & MmioRead16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNT].Offset));

#if DEBUG_EYE			
			Print(L"BERCNT: [%03x]===\n", Result); 
#else
			//in fast mode, not record the log to file, only print it to screen
			if(fast){
				if(Result <= pass_threshold){
					DataTemp[xx][yy] = L'o';

					SpecialPointFlag++;
					if(SpecialPointFlag == 1){
						Point_VRmax = (UINT8)iy;
					}

					if(iy == 1){
						PH1_neg_Flag++;
						if(PH1_neg_Flag == 1){
							Point_PH1_neg = (UINT8)ix;
							Point_PH1_neg = 128-Point_PH1_neg;
						}

						Point_PH1_pos = (UINT8)ix;
					}

					if(iy == 0){
						PH0_neg_Flag++;
						if(PH0_neg_Flag == 1){
							Point_PH0_neg = (UINT8)ix;
							Point_PH0_neg = 128-Point_PH0_neg;
						}

						Point_PH0_pos = (UINT8)ix;

					}


					
					
				}else{
					DataTemp[xx][yy] = L'.';
				}
				continue;
			}else{
				Print(L"[%03x] ", Result);
			}
#endif
			if(ix == 31){
				Print(L"\n");
			}

#if DEBUG_EYE
			//Step 2-2 
			//dump some EPHY registers 
			PCIeDumpMem(0xFEB14000+(0xFF00&((pMode3Reg+eye_LaneSel)->Reg[PH_OS].Offset)),0x100);
			PCIeDumpMem(0xFEB16900,0x100);
#endif			

			//Step 2-3
			//Determine Log File Name
			LogFileName[17] = (UINT16)(0x30+(eye_LaneSel/10));
			LogFileName[18] = (UINT16)(0x30+(eye_LaneSel%10));

			
			//Step 2-4
			//Note: we can only leave a Step2-4 or Step2-5 to get a single Eye Diagram we wanted. 
			//
			// generate a Eye Diagram A
			LogFileName[20] = L'A';
			if(Result <= pass_threshold){
				WriteIIPos(pLogFileName,L"o",pos);
				pos++;
			}else{
				WriteIIPos(pLogFileName,L"-",pos);
				pos++;
			}
			if(ix == 31){
				WriteIIPos(pLogFileName,L"\n",pos);
				pos++;
			}

			//Step 2-5
			//generate a new Eye Diagram B
			LogFileName[20] = L'B';
			if(Result <= pass_threshold){
				WriteIIPos(pLogFileName,L"o",posB);
				posB++;
			}else{
				WriteIIPos(pLogFileName,L"-",posB);
				posB++;
			}
			WriteIIPos(pLogFileName,L"  ",posB);
			posB+=2;
			
			if(ix == 31){
				WriteIIPos(pLogFileName,L"\n",posB);
				posB++;

				if(iy != 0){
					CoorX[0] = (0x30+((iy-1)/10));
					CoorX[1] = (0x30+((iy-1)%10));
					WriteIIPos(pLogFileName,pCoorX,posB);
					posB+=2;
				}else{
		    		WriteIIPos(pLogFileName,L"  ",posB); posB+=2;
					WriteIIPos(pLogFileName,L"32 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"33 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"34 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"35 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"36 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"37 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"38 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"39 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"40 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"41 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"42 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"43 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"44 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"45 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"46 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"47 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"48 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"49 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"50 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"51 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"52 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"53 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"54 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"55 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"56 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"57 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"58 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"59 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"60 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"61 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"62 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"63 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"00 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"01 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"02 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"03 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"04 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"05 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"06 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"07 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"08 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"09 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"10 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"11 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"12 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"13 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"14 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"15 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"16 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"17 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"18 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"19 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"20 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"21 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"22 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"23 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"24 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"25 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"26 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"27 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"28 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"29 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"30 ",posB); posB+=3;
					WriteIIPos(pLogFileName,L"31 ",posB); posB+=3;
					
					
				}
			}
			



			
		}
/*		
VID
10de 1287
*/
	}


//3  Fast mode special:
	//eye 1
	if(fast){
		for(yy = 0; yy<32;yy++){
			iy = 31-yy;	 //  31-30-29....0
			for(xx=0; xx<64;xx++){
				if(xx == 0){
					Print(L"%02d|",iy);
				}
				Print(L"%c",DataTemp[xx][yy]);
			}
			Print(L"\n");
		}

		Print(L"   ");


		//Print(L"\n   ");
		for(xx=0;xx<2;xx++){
			for(ix=0;ix<64;ix++){
				Print(L"%d",CoorxArray[xx][ix]);
			}
			Print(L"\n   ");
		}
		Print(L"\n");



		//summary some parameters for Keith
		Print(L"Summary:\n");
		Print(L"           PH0_neg,PH0_pos,PH1_neg,PH1_pos,VRmax___DCout,HFout,OSout,W1out,W2out\n");
		Print(L"SearchFlag:%c    -%02d%c     %02d%c    -%02d%c     %02d%c   %02d%c    0x%02x%c 0x%02x%c 0x%02x%c 0x%02x%c 0x%02x\n",
				9,Point_PH0_neg, 9,Point_PH0_pos, 
				9,Point_PH1_neg, 9,Point_PH1_pos,
				9,Point_VRmax,
				9,DCout,9,HFout,9,OSout,9,W1out,9,W2out);
		Print(L"EyeWidthFlag:%c  0x%02x(%d)\n" , 
				9, 
				Point_PH0_neg+Point_PH0_pos+1, 
				Point_PH0_neg+Point_PH0_pos+1);

	
#if 0		
		for(xx=0; xx<64;xx++){
			if(xx < 32){	//32-33-34-35-...63-0-1-2-3....31
				ix = 32+xx;
			}else{
				ix = xx-32;
			}
			Print(L"%02d ", ix);
		}
#endif		
	}

#if 0
	//eye 2
	if(fast){
		for(yy = 0; yy<32;yy++){
			for(xx=0; xx<64;xx++){
				Print(L"%c",DataTemp[xx][yy]);
			}
			Print(L"\n");
		}
	}
#endif	
	if(!fast){
		Print(L"Please check EyeMode3Scan-lanexx-x.log to check Pass/Fail\n");
	}
	
	return  EFI_SUCCESS;
}







EFI_STATUS
EyeTest_Mode3(
	M3StFEL *pMode3Reg, 
	PARAM_M3 * ParamMode3)
{
	UINT32 X = ParamMode3->s_X;
	UINT32 Y = ParamMode3->s_Y;
	UINT64 mode3_scantime = ParamMode3->s_mode3_scantime;
	UINT32 eye_LaneSel = ParamMode3->s_eye_LaneSel;
	UINT32 eye_mode3_GenSpeed = ParamMode3->s_eye_mode3_GenSpeed;
	UINT32 BaseAddr = ParamMode3->s_BaseAddr;

#if DEBUG_EYE
	Print(L"DEBUG-EyeMonitor_Mode3:\n");
	Print(L"     X=%d,Y=%d\n",X,Y);
	Print(L"     mode3_scantime= 0x%x\n",mode3_scantime);
	Print(L"     eye_LaneSel=0x%08x\n",eye_LaneSel);
	Print(L"     eye_mode3_GenSpeed=0x%08x\n",eye_mode3_GenSpeed);
	Print(L"     BaseAddr=0x%08x\n",BaseAddr);
#endif
	
	VALID_STATUS(X);
	VALID_STATUS(Y);
	VALID_STATUS(mode3_scantime);
	//VALID(eye_addr_RSTB);
	VALID_STATUS(eye_LaneSel);
	VALID_STATUS(eye_mode3_GenSpeed);
	
	Set_R_EYE_MANU_MUX(BaseAddr,1); //mode 3 need SW control

	
	// Step1:
	// SW set register MCU_EYESCANEN_PEnn to 0 
	//MmioBitFieldWrite8(BaseAddr + PCIEPHYCFG_EYE_MONITOR_2 + 1, 5,5, 1);	//write 1 to clear	
	
	// Step2:
	// X, Y
	MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[PH_OS].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[PH_OS].start),
						((pMode3Reg+eye_LaneSel)->Reg[PH_OS].end), 
						(UINT16)X); 
	
	switch(eye_mode3_GenSpeed){
		case 1:
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].start),
						((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].end), 
						(UINT16)Y); 			
			break;
		case 2: 
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].start),
						((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].end), 
						(UINT16)Y); 				
			break;
		case 3:
			MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].start),
						((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].end), 
						(UINT16)Y); 				
			break;
		default:
			Print(L"ERROR! eye_mode3_GenSpeed\n");
	}
	
	
	
	
	// FRP**_BERCNTRSTB
	MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].start),
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].end), 
						0); 
	
	// Step3:
	// Wait greater than 16ns and set FRP*_BERCNTRSTB to 1.
	gBS->Stall(1);														//delay 1us  --should wait at least 16ns
	MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].start),
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].end), 
						1); 
	
	
	// Step4:
	// then wait greater than 16ns and set FRP*_BERCNTEN(FRP00_BERCNTEN at Rx222h)	to 1
	gBS->Stall(1);	
	MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].start),
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].end), 
						1); 
	
	// Step5:
	// Wait some moment set FRP*_BERCNTEN and FRP*_BERCNTRSTB to 0, read the register EP*_BERCNT(ex: EP00_BERCNT_ at RX266[9:0])
	gBS->Stall((UINTN)mode3_scantime);
	MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].Offset), 
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].start),
						((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].end), 
						0); 
	
	gBS->Stall(1);
	//	Read  offset + 0x44   ----266 - 2E6  -366 - .....
	//	lane0 222 - lane1 2A2  -- 
	//	Need to add "80h" per lane	
#if DEBUG_EYE	
	Print(L"<EyeTest> Result_Val = [0x%x]\n", 
					MmioRead16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNT].Offset))); 
#endif


	return EFI_SUCCESS;
}

/**
this routine can be used to verify EyeMonitor in CPU view
**/
EFI_STATUS
EyeTest(CHAR16 * CfgFile)
{
	CHAR16 * FileName = CfgFile;
	CHAR16 *strinx = NULL;
	CHAR16 *strinx1 = NULL;
	UINT32 X1,Y1, X2, Y2;
	UINT32 TimerLimit;
	UINT32 BaseAddr;
	UINT32 PortName;
	UINT32 Threshold;
	UINT32 ScanDone;
	UINT32 eye_LaneSel;
	//GetParamData(FileName, L"eye_mode", strinx);
	
	UINT32 X,Y;

	UINT64 mode3_scantime;
	PARAM_M3 ParamMode3;

	//UINT32 eye_addr_RSTB;
	UINT32 BiosWrEnReg;

	UINTN GetDataStatus = NOT_FOUND_STRING;

	M3StFEL *pMode3Reg = Mode3Def;
	RFD *pMode12Reg =  Mode12Def;

	UINT32 eye_mode3_GenSpeed = NOT_FOUND_STRING;

#if 0
	Print(L"-->Test: 0x%08x,%d,%d",
			(pMode3Reg+2)->Reg[EQTNVTH_G2].Offset,
			(pMode3Reg+2)->Reg[EQTNVTH_G2].start,
			(pMode3Reg+2)->Reg[EQTNVTH_G2].end);
#endif


	//StrCpy(FileName,CfgFile);
	strinx= (CHAR16 *)AllocateZeroPool(512);
	strinx1= (CHAR16 *)AllocateZeroPool(512);

	//
	// Read data from configure file
	//
	
	//GetParamData(L"zzz.eye", L"eye_mode", strinx);
//	GetParamData(FileName, L"eye_mode", strinx);
//	Print(L"UUU-DEBUG = 1.6  %s\n",FileName);
	GetDataStatus = GetParamData(FileName, L"eye_mode", strinx);
	if(GetDataStatus != NOT_FOUND_STRING){
#if DEBUG_EYE	
		Print(L"<EyeTest> eye_mode = %s\n", strinx);
#endif
	}else{
		Print(L"--------- eye_mode - NULL\n");
	}


	
	GetDataStatus = GetParamData(FileName, L"eye_x1", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){
#if DEBUG_EYE	
		Print(L"<EyeTest-d> eye_x1 = %s\n", strinx1);
#endif
		X1 = Str2Num(strinx1);
	}else{
		X1 = NOT_FOUND_STRING;
	}


	GetDataStatus = GetParamData(FileName, L"eye_y1", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){
#if DEBUG_EYE	
		Print(L"<EyeTest-d> eye_y1 = %s\n", strinx1);
#endif
		Y1 = Str2Num(strinx1);
	}else{
		Y1 = NOT_FOUND_STRING;
	}



	GetDataStatus = GetParamData(FileName, L"eye_x2", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){
#if DEBUG_EYE		
		Print(L"<EyeTest-d> eye_x2 = %s\n", strinx1);
#endif
		X2 = Str2Num(strinx1);
	}else{
		X2 = NOT_FOUND_STRING;
	}


	GetDataStatus = GetParamData(FileName, L"eye_y2", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){	
#if DEBUG_EYE		
		Print(L"<EyeTest-d> eye_y2 = %s\n", strinx1);
#endif
		Y2 = Str2Num(strinx1);
	}else{
		Y2 = NOT_FOUND_STRING;
	}
	
#if DEBUG_EYE
			Print(L"<EyeTest-d> 	   = 0x%x[%d]\n", X1,X1);
			Print(L"<EyeTest-d> 	   = 0x%x[%d]\n", Y1,Y1);
			Print(L"<EyeTest-d> 	   = 0x%x[%d]\n", X2,X2);
			Print(L"<EyeTest-d> 	   = 0x%x[%d]\n", Y2,Y2);	
#endif	

	if((X1==NOT_FOUND_STRING)||(X1==NOT_FOUND_STRING)||(X1==NOT_FOUND_STRING)||(X1==NOT_FOUND_STRING)){
		Print(L"--------- Eye Scan Range - NULL\n");	
	}else{

		Print(L"<EyeTest> Eye Scan Range: {%d, %d}, {%d, %d}\n", X1,Y1,X2,Y2);
	}


	GetDataStatus = GetParamData(FileName, L"eye_TimerLimit", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){	
		TimerLimit = Str2Num(strinx1);
		Print(L"<EyeTest> eye_TimerLimit = [0x%x] %d\n", TimerLimit, TimerLimit);
	}else{
		TimerLimit = NOT_FOUND_STRING;
		Print(L"--------- eye_TimerLimit - NULL\n");

	}
	
	GetDataStatus = GetParamData(FileName, L"eye_MemBase", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){	
		BaseAddr = Str2Num(strinx1);
		Print(L"<EyeTest> eye_MemBase = [0x%08x]\n", BaseAddr);
	}else{
		BaseAddr = NOT_FOUND_STRING;
		Print(L"--------- eye_MemBase - NULL\n");
	}
	
	GetDataStatus = GetParamData(FileName, L"eye_PortName", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){	
		PortName = Str2Num(strinx1);
		Print(L"<EyeTest> eye_PortName = [0x%x]\n", PortName);
	}else{
		PortName = NOT_FOUND_STRING;
		Print(L"--------- eye_PortName - NULL\n");
	}
	
	GetDataStatus = GetParamData(FileName, L"eye_threshold", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){	
		Threshold= Str2Num(strinx1);
		Print(L"<EyeTest> eye_threshold = [0x%x]\n", Threshold);
	}else{
		Threshold = NOT_FOUND_STRING;
		Print(L"--------- eye_threshold - NULL\n");
	}
	GetDataStatus = GetParamData(FileName, L"eye_LaneSel", strinx1);	//Mode 2
	if(GetDataStatus != NOT_FOUND_STRING){	
		eye_LaneSel= Str2Num(strinx1);
		Print(L"<EyeTest> eye_LaneSel = [0x%x]\n", eye_LaneSel);	
	}else{
		eye_LaneSel = NOT_FOUND_STRING;
		Print(L"--------- eye_LaneSel - NULL\n");
	}


	GetDataStatus = GetParamData(FileName, L"eye_BIOS_WRITE_EN_REG", strinx1);
	if(GetDataStatus != NOT_FOUND_STRING){	
		BiosWrEnReg = Str2Num(strinx1);
		Print(L"<EyeTest> BIOS Write En Reg:  Rx%x\n", BiosWrEnReg);
	}else{
		BiosWrEnReg = NOT_FOUND_STRING;
		Print(L"--------- BIOS Write En Reg - NULL\n");

	}
	

		
	//
	// Firstly, enable the BIOS write for those registers
	//
	VALID_1(BiosWrEnReg);
	VALID_1(BaseAddr);
	MmioBitFieldWrite8(BaseAddr + BiosWrEnReg, 6,6,1);

	//
	// Mode 1
	//
	//1 Mode1
	if(!StrCmp(strinx, L"Mode1")){
		Print(L"<EyeTest> Current:Mode1\n");
		VALID(X1);
		VALID(X2);
		VALID(Y1);
		VALID(Y2);
		VALID(PortName);
		VALID(Threshold);
		VALID(TimerLimit);

		Set_R_EYE_MANU_MUX(BaseAddr,0); //mode 1 need HW control


		//Write Rx2901[14] EYESCAN_DONE_Penn as 1b to clear it(RW1C)
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EYESCAN_DONE)->Offset), 
									((pMode12Reg+EYESCAN_DONE)->start),
									((pMode12Reg+EYESCAN_DONE)->end), 
									1);  

		// Step1: Set X1 Y1 X2 Y2
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_X1)->Offset), 
									((pMode12Reg+RANGE_X1)->start),
									((pMode12Reg+RANGE_X1)->end), 
									(UINT8)X1); 	
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_Y1)->Offset), 
									((pMode12Reg+RANGE_Y1)->start),
									((pMode12Reg+RANGE_Y1)->end), 
									(UINT8)Y1);
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_X2)->Offset), 
									((pMode12Reg+RANGE_X2)->start),
									((pMode12Reg+RANGE_X2)->end), 
									(UINT8)X2);
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_Y2)->Offset), 
									((pMode12Reg+RANGE_Y2)->start),
									((pMode12Reg+RANGE_Y2)->end), 
									(UINT8)Y2);
		
		// Step2: ALL_PORT = 1b
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+ALL_PORT)->Offset), 
									((pMode12Reg+ALL_PORT)->start),
									((pMode12Reg+ALL_PORT)->end), 
									1);
		
		// Step3: Select port, Threshold and TimerLimit
		//SW set register EQ_PORT_NAME[8:0] (Rx 2901h)RBER_THRESHHOLD_[3:0] (Rx2907h) and  MCU_EYESCANTM_PEnn[7:0](Rx2900h) 
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EQ_PORT_NAME)->Offset), 
									((pMode12Reg+EQ_PORT_NAME)->start),
									((pMode12Reg+EQ_PORT_NAME)->end), 
									PortName);	
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RBER_THRESHHOLD)->Offset), 
									((pMode12Reg+RBER_THRESHHOLD)->start),
									((pMode12Reg+RBER_THRESHHOLD)->end), 
									(UINT8)Threshold);	
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EYESCANTM)->Offset), 
											((pMode12Reg+EYESCANTM)->start),
											((pMode12Reg+EYESCANTM)->end), 
											TimerLimit);	

		// Step4: Eye scan enable(MCU_EYESCANEN) = 1b
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EYESCANEN)->Offset), 
											((pMode12Reg+EYESCANEN)->start),
											((pMode12Reg+EYESCANEN)->end), 
											1);		
		// Step5: Wait Scan Done
		ScanDone = 0;
		do{
			ScanDone = MmioBitFieldRead32(BaseAddr + ((pMode12Reg+EYESCAN_DONE)->Offset),
													((pMode12Reg+EYESCAN_DONE)->start),
													((pMode12Reg+EYESCAN_DONE)->end));
			
		}while(ScanDone == 0);

		// Step6: SCAN BER_VAL[2047:0]
		//OutPutBerVal(CfgFile,X2-X1,Y2-Y1,L"Eye_Mode1_BER_VAL.log");
		OutPutBerVal_2(CfgFile,X1,Y1,X2,Y2, L"Eye_Mode1_BER_VAL.log");
	}
	//
	// Mode 2
	//
	//1 Mode2
	else if(!StrCmp(strinx, L"Mode2")){
		Print(L"<EyeTest> Current:Mode2\n");
		VALID(X1);
		VALID(X2);
		VALID(Y1);
		VALID(Y2);
		VALID(eye_LaneSel);
		VALID(PortName);
		VALID(Threshold);
		VALID(TimerLimit);

		Set_R_EYE_MANU_MUX(BaseAddr,0); //mode 2 need HW control



		//Write Rx2901[14] EYESCAN_DONE_Penn as 1b to clear it(RW1C)
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EYESCAN_DONE)->Offset), 
									((pMode12Reg+EYESCAN_DONE)->start),
									((pMode12Reg+EYESCAN_DONE)->end), 
									1);  



		// Step1: Set X1 Y1 X2 Y2
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_X1)->Offset), 
									((pMode12Reg+RANGE_X1)->start),
									((pMode12Reg+RANGE_X1)->end), 
									(UINT8)X1); 	
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_Y1)->Offset), 
									((pMode12Reg+RANGE_Y1)->start),
									((pMode12Reg+RANGE_Y1)->end), 
									(UINT8)Y1);
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_X2)->Offset), 
									((pMode12Reg+RANGE_X2)->start),
									((pMode12Reg+RANGE_X2)->end), 
									(UINT8)X2);
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RANGE_Y2)->Offset), 
									((pMode12Reg+RANGE_Y2)->start),
									((pMode12Reg+RANGE_Y2)->end), 
									(UINT8)Y2);		
		// Step2: ALL_PORT = 0b
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+ALL_PORT)->Offset), 
									((pMode12Reg+ALL_PORT)->start),
									((pMode12Reg+ALL_PORT)->end), 
									0);		
		//        Lane select-LANE_SEL
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+LANE_SEL)->Offset), 
									((pMode12Reg+LANE_SEL)->start),
									((pMode12Reg+LANE_SEL)->end), 
									(UINT8)eye_LaneSel);		

		
		// Step3: Select port, Threshold and TimerLimit
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EQ_PORT_NAME)->Offset), 
									((pMode12Reg+EQ_PORT_NAME)->start),
									((pMode12Reg+EQ_PORT_NAME)->end), 
									PortName);	
		MmioBitFieldWrite8(BaseAddr + ((pMode12Reg+RBER_THRESHHOLD)->Offset), 
									((pMode12Reg+RBER_THRESHHOLD)->start),
									((pMode12Reg+RBER_THRESHHOLD)->end), 
									(UINT8)Threshold);	
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EYESCANTM)->Offset), 
											((pMode12Reg+EYESCANTM)->start),
											((pMode12Reg+EYESCANTM)->end), 
											TimerLimit);

		// Step4: Eye scan enable = 1b
		MmioBitFieldWrite32(BaseAddr + ((pMode12Reg+EYESCANEN)->Offset), 
											((pMode12Reg+EYESCANEN)->start),
											((pMode12Reg+EYESCANEN)->end), 
											1);		

		// Step5: Wait Scan Done
		ScanDone = 0;
		do{
			ScanDone = MmioBitFieldRead32(BaseAddr + ((pMode12Reg+EYESCAN_DONE)->Offset),
													((pMode12Reg+EYESCAN_DONE)->start),
													((pMode12Reg+EYESCAN_DONE)->end));
		}while(ScanDone == 0);
		
		// Step6: SCAN BER_VAL[2047:0]
		//OutPutBerVal(CfgFile,X2-X1,Y2-Y1,L"Eye_Mode2_BER_VAL.log");
		OutPutBerVal_2(CfgFile,X1,Y1,X2,Y2, L"Eye_Mode2_BER_VAL.log");

		
	}
	//*******
	// Mode 3
	//*******
	//1 Mode3
	else if(!StrCmp(strinx, L"Mode3")){
		Print(L"<EyeTest> Current:Mode3\n");

		//
		//
		//
		GetDataStatus = GetParamData(FileName, L"eye_x", strinx1);	 //Mode 3
		if(GetDataStatus != NOT_FOUND_STRING){	
			X= Str2Num(strinx1);
#if DEBUG_EYE	
			Print(L"<EyeTest-d> eye_x = [0x%x]\n", X);
#endif
		}else{
			X = NOT_FOUND_STRING;
		}
		GetDataStatus = GetParamData(FileName, L"eye_y", strinx1);	 //Mode 3
		if(GetDataStatus != NOT_FOUND_STRING){	
			Y= Str2Num(strinx1);
#if DEBUG_EYE
			Print(L"<EyeTest-d> eye_y = [0x%x]\n", Y);
#endif
		}else{
			Y = NOT_FOUND_STRING;
		}
		
		if((X==NOT_FOUND_STRING)||(X==NOT_FOUND_STRING)){
			Print(L"--------- = Point Select - NULL\n", X,Y);	
		}else{
			Print(L"<EyeTest> = {%d,%d}\n", X,Y);
		}
		//
		//
		//
		GetDataStatus = GetParamData(FileName, L"eye_sample_time", strinx1);
		if(GetDataStatus != NOT_FOUND_STRING){	
			mode3_scantime = Str2Num(strinx1);
			Print(L"<EyeTest> eye_sample_time - for mode3 = [%d]us\n", mode3_scantime);
		}else{
			mode3_scantime = NOT_FOUND_STRING;
			Print(L"--------- eye_sample_time - for mode3 - NULL\n");
		}
		//
		//
		//
		GetDataStatus = GetParamData(FileName, L"eye_mode3_GenSpeed", strinx1);
		if(GetDataStatus != NOT_FOUND_STRING){	
			eye_mode3_GenSpeed = Str2Num(strinx1);
			Print(L"<EyeTest> eye_mode3_GenSpeed - for mode3 = [%d]\n", eye_mode3_GenSpeed);
		}else{
			mode3_scantime = NOT_FOUND_STRING;
			Print(L"--------- eye_mode3_GenSpeed - for mode3 - NULL\n");
		}


		ParamMode3.s_X = X;
		ParamMode3.s_Y = Y;
		ParamMode3.s_BaseAddr = BaseAddr;
		ParamMode3.s_eye_LaneSel = eye_LaneSel;
		ParamMode3.s_eye_mode3_GenSpeed = eye_mode3_GenSpeed;
		ParamMode3.s_mode3_scantime =mode3_scantime;

		if( EFI_NOT_FOUND == EyeTest_Mode3(pMode3Reg,&ParamMode3)){
			goto __GoDirectly;
		}
#if 0

		VALID(X);
		VALID(Y);
		VALID(mode3_scantime);
		//VALID(eye_addr_RSTB);
		VALID(eye_LaneSel);
		VALID(eye_mode3_GenSpeed);
		
		Set_R_EYE_MANU_MUX(BaseAddr,1); //mode 3 need SW control

		

		

		// Step1:
		// SW set register MCU_EYESCANEN_PEnn to 0 
		//MmioBitFieldWrite8(BaseAddr + PCIEPHYCFG_EYE_MONITOR_2 + 1, 5,5, 1);  //write 1 to clear	
		
		// Step2:
		// X, Y
		MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[PH_OS].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[PH_OS].start),
							((pMode3Reg+eye_LaneSel)->Reg[PH_OS].end), 
							(UINT16)X);	
		
		switch(eye_mode3_GenSpeed){
			case 1:
				MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].start),
							((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G1].end), 
							(UINT16)Y);				
				break;
			case 2: 
				MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].start),
							((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G2].end), 
							(UINT16)Y);					
				break;
			case 3:
				MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].start),
							((pMode3Reg+eye_LaneSel)->Reg[EQTNVTH_G3].end), 
							(UINT16)Y);					
				break;
			default:
				Print(L"ERROR! eye_mode3_GenSpeed\n");
		}



		
		// FRP**_BERCNTRSTB
		MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].start),
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].end), 
							0);	

		// Step3:
		// Wait greater than 16ns and set FRP*_BERCNTRSTB to 1.
		gBS->Stall(1);                                                      //delay 1us  --should wait at least 16ns
		MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].start),
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTRSTB].end), 
							1);	

		
		// Step4:
		// then wait greater than 16ns and set FRP*_BERCNTEN(FRP00_BERCNTEN at Rx222h)  to 1
		gBS->Stall(1);  
		MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].start),
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].end), 
							1);	

		// Step5:
		// Wait some moment set FRP*_BERCNTEN and FRP*_BERCNTRSTB to 0, read the register EP*_BERCNT(ex: EP00_BERCNT_ at RX266[9:0])
		gBS->Stall((UINTN)mode3_scantime);
		MmioBitFieldWrite16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].Offset), 
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].start),
							((pMode3Reg+eye_LaneSel)->Reg[BERCNTEN].end), 
							0);	

		gBS->Stall(1);
		//  Read  offset + 0x44   ----266 - 2E6  -366 - .....
		//  lane0 222 - lane1 2A2  -- 
		//  Need to add "80h" per lane		
		Print(L"<EyeTest> Result_Val = [0x%x]\n", 
						MmioRead16(BaseAddr + ((pMode3Reg+eye_LaneSel)->Reg[BERCNT].Offset))); 


		//for debug, we also dump the BER_VAL
		//OutPutBerVal(CfgFile,X,Y,L"Eye_Mode3_BER_VAL.log");

#endif
	}
	else{ //1 Modex
		Print(L"<EyeTest> Current:Unknown mode\n");

	//	OutPutBerVal(FileName, 234, 6, L"eee.log");
/*		WriteIIPos(L"a.log", L"*", 0);
		WriteIIPos(L"a.log", L"-", 1);
		WriteIIPos(L"a.log", L"-", 2);
		WriteIIPos(L"a.log", L"*", 3);
		WriteIIPos(L"a.log", L"\n", 4);

		WriteIIPos(L"a.log", L"+", 5);
		WriteIIPos(L"a.log", L"#", 6);
		WriteIIPos(L"a.log", L"#", 7);
		WriteIIPos(L"a.log", L"+", 8);
		WriteIIPos(L"a.log", L"\n", 9);		

		WriteIIPos(L"a.log", L"*", 10);
		WriteIIPos(L"a.log", L"-", 11);
		WriteIIPos(L"a.log", L"-", 12);
		WriteIIPos(L"a.log", L"*", 13);
		WriteIIPos(L"a.log", L"\n", 14);
		*/
		//OutPutBerVal(FileName, 7, 3, L"aaa.log");
		OutPutBerVal_2(CfgFile,32,0,38,4, L"Eye_ModeX_BER_VAL1.log");
		OutPutBerVal_2(CfgFile,32,0,31,31, L"Eye_ModeX_BER_VAL.log");
		WriteIIPos(L"a.log", L"*", 0);
	}


__GoDirectly:

	//
	// finally
	// Disable the BIOS write permission for PEMCU related registers 
	//
	MmioBitFieldWrite8(BaseAddr + BiosWrEnReg, 6, 6, 0);

__GoDirectly2:

	FreePool(strinx1);
	FreePool(strinx);
	

	return EFI_SUCCESS;
}




/**
this routine is a tool to create cfg file template for user
	@param:
		mode: can be 1/2/3/4 corresponding to Mode1/2/3/not supported mode
**/
VOID
CreateCfgFile(CHAR16 *mode)
{

	UINT8 modex;
	
	if(!StrCmp(mode, L"mode1")){
		modex = 1;
	}
	else if(!StrCmp(mode, L"mode2")){
		modex = 2;
	}	
	else if(!StrCmp(mode, L"mode3")){
		modex = 3;
	}
	else if(!StrCmp(mode, L"modex")){
		modex = 4;
	}
	else{
		modex = 4;
	}

	Print(L"//config file for %s\n",mode);
	
	//common part
	Print(L"eye_mode = Mode4\n");
	Print(L"eye_MemBase =  0x07000000   //EPHY register base address\n");
	//Print(L"BER_VAL_BASE = 0x2A00   	//base address of BER result value\n");
	Print(L"eye_BIOS_WRITE_EN_REG = RxE0   //CHX002 E0[6]\n");
	


	//private part
	switch(modex){
	case 1: //mode 1
		Print(L"eye_x1 = 32\n");
		Print(L"eye_y1 = 0\n");
		Print(L"eye_x2 = 31\n");
		Print(L"eye_y2 = 31\n");
		Print(L"eye_PortName = 0x1  \n");
				Print(L"				//VPI 9'b1_0000_0000\n\
				//PE4 9'b0_0000_0001\n\
				//PE5 9'b0_0000_0010\n\
				//PE6 9'b0_0000_0100\n\
				//PE7 9'b0_0000_1000\n\
				//PE0 9'b0_0001_0000\n\
				//PE1 9'b0_0010_0000\n\
				//PE2 9'b0_0100_0000\n\
				//PE3 9'b0_1000_0000\n");	
		Print(L"eye_LaneSel = 0x7       //lane 0 - 7   (only for Mode2)\n");
		Print(L"eye_threshold = 0    [3:0]\n");
		Print(L"eye_TimerLimit = 0xFF     //timer limit\n");
				Print(L"				//0 ~ 1Ah: Reserved\
				//1Bh: BERCNTEN assert 130ns\
				//1Ch: BERCNTEN assert 140ns\
				//... \
				//FEh: BERCNTEN assert 2400ns\
				//FFh: BERCNTEN assert 2410ns\n");		
		break;
	case 2: //mode 2
		Print(L"eye_x1 = 32\n");
		Print(L"eye_y1 = 0\n");
		Print(L"eye_x2 = 31\n");
		Print(L"eye_y2 = 31\n");	
		Print(L"eye_PortName = 0x1  \n");
		Print(L"//VPI 9'b1_0000_0000\n\
				//PE4 9'b0_0000_0001\n\
				//PE5 9'b0_0000_0010\n\
				//PE6 9'b0_0000_0100\n\
				//PE7 9'b0_0000_1000\n\
				//PE0 9'b0_0001_0000\n\
				//PE1 9'b0_0010_0000\n\
				//PE2 9'b0_0100_0000\n\
				//PE3 9'b0_1000_0000\n");	
		Print(L"eye_threshold = 0    [3:0]\n");
		Print(L"eye_TimerLimit = 0xFF     //timer limit\n");
				Print(L"				//0 ~ 1Ah: Reserved\
				//1Bh: BERCNTEN assert 130ns\
				//1Ch: BERCNTEN assert 140ns\
				//... \
				//FEh: BERCNTEN assert 2400ns\
				//FFh: BERCNTEN assert 2410ns\n");	
		
		break;
	case 3: //mode 3
		Print(L"eye_x = 0			//for mode 3\n");
		Print(L"eye_y = 0			//for mode 3\n");
		//Print(L"eye_addr_RSTB = 0x222   //for mode 3\n");   // this arg maybe need more flexible
		Print(L"eye_sample_time = 2     //us, for Mode3 only\n");
		Print(L"eye_mode3_GenSpeed = 3	//for mode 3\n");
		break;
	case 4: //all variables
		Print(L"eye_BIOS_WRITE_EN_REG = RxE0   //CHX002 E0[6]\n");
		Print(L"eye_mode = Mode4\n");
		Print(L"eye_MemBase =  0x07000000	//EPHY register base address\n");
		Print(L"eye_x1 = 32\n");
		Print(L"eye_y1 = 0\n");
		Print(L"eye_x2 = 31\n");
		Print(L"eye_y2 = 31\n");	
		Print(L"eye_PortName = 0x1  \n");
		Print(L"//VPI 9'b1_0000_0000\n\
				//PE4 9'b0_0000_0001\n\
				//PE5 9'b0_0000_0010\n\
				//PE6 9'b0_0000_0100\n\
				//PE7 9'b0_0000_1000\n\
				//PE0 9'b0_0001_0000\n\
				//PE1 9'b0_0010_0000\n\
				//PE2 9'b0_0100_0000\n\
				//PE3 9'b0_1000_0000\n");	
		Print(L"eye_threshold = 0    [3:0]\n");
		Print(L"eye_TimerLimit = 0xFF 	//timer limit\n");
				Print(L"				//0 ~ 1Ah: Reserved\
				//1Bh: BERCNTEN assert 130ns\
				//1Ch: BERCNTEN assert 140ns\
				//... \
				//FEh: BERCNTEN assert 2400ns\
				//FFh: BERCNTEN assert 2410ns\n");	
		Print(L"eye_LaneSel = 0x7		//lane 0 - 7   (only for Mode2)\n");
		Print(L"eye_x = 0x40			//for mode 3\n");
		Print(L"eye_y = 0x36			//for mode 3\n");
		Print(L"eye_mode3_GenSpeed = 3	//for mode 3\n");
		Print(L"eye_sample_time = 2 	//us, for Mode3 only\n");
		//Print(L"BER_VAL_BASE = 0x2A00	//base address of BER result value\n");

		break;
	default:
		Print(L"ERROR: Not supported mode! \n");
		break;

	}
	



}




